<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name = "run_slam_optimization" default = "false"/>
<arg name = "run_slam_mapping" default = "true"/> 
<arg name = "run_traversable_area_extraction" default = "true"/> 
<arg name = "run_dynamicobject_detection" default = "false"/> 
 <arg name="run_lidar_odometry"  default="true" />
  <arg name="run_getindnode"  default="false" />
  <arg name = "gps_convert" default = "false"/>  
  
  <arg name="configfile" default="$(find sensor_driver)/config/configmulti.xml" />
  <arg name="logdir" default="--log_dir=/home/zack-liu/catkin_yuanshi/log" />
  <arg name="glogparam" default="--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=5   $(arg logdir)" />

  <param name="robot_description"
    textfile="$(find sensor_driver)/urdf/multivelodyne_3d.urdf" />

  <node name="robot_state_publisher" pkg="robot_state_publisher"
    type="robot_state_publisher" />


<group if="$(arg run_slam_mapping)">
  <node name="iv_slam_mapping_node" pkg="iv_slam_mapping_ros"
      type="iv_slam_mapping_node" args="
          -slam_configuration_directory $(find iv_slam_mapping_ros)/slam_configuration_files
          -slam_configuration_basename rciv_slam_fused.lua
--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=0   $(arg logdir)"          
      output="screen" >
    <remap from="points2" to="lidar_cloud_calibrated" />
    <!--remap from="points2_2" to="compressed_pointcloud lidar_cloud_calibrated " /-->
    <remap from="imu" to="imudata" />
  </node>

	  
</group>

<group if="$(arg run_slam_optimization)">
 <node name="iv_slam_optimization_node" pkg="iv_slam_optimization_ros"
      type="iv_slam_optimization_node" args="
          -slam_configuration_directory $(find iv_slam_optimization_ros)/slam_configuration_files
          -slam_configuration_basename rciv_slam_fused.lua
 --logtostderr=0  --colorlogtostderr=1 --stderrthreshold=0  $(arg logdir)"          
      output="screen">  
  </node>




<node name="rviz" pkg="rviz" type="rviz" required="true"
     args="-d $(find iv_slam_optimization_ros)/slam_configuration_files/iv_slam_optimization_ros.rviz" />
</group>


<group if="$(arg run_dynamicobject_detection)">
<node pkg="dynamicobject" type="dynamicobject" name="dynamicobject" args=" --logtostderr=0  --colorlogtostderr=1 --stderrthreshold=2  $(arg logdir)" >
  <param name="heightdiff_threshold" value="0.3"/>
  </node>
</group>


<group if="$(arg run_lidar_odometry)">
<node pkg="covgrid_slam_ros" type="lidarodometrymain" name="lidarodometrymain" args="--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=2   $(arg logdir)" output="screen">
	  <param name="configuration_directory" value="$(find covgrid_slam_ros)/config" />
	  <param name="configuration_basename" value="localmap.lua" />
	  <param name="withoutimu" value="true"/>
	  <param name="withgps" value="true"/>
	  <param name="insvelocity" value="true"/>
	  <param name="withecu" value="false"/>
	  <param name="sendflag" value="false"/>
	  <param name="local_ip" value="192.168.0.112"/>
	  <param name="local_port" value="9911"/>
	  <param name="remote_ip" value="192.168.0.111"/>
	  <param name="remote_port" value="9912"/>
	  </node>
	
  
	  <node pkg="covgrid_slam_ros" type="transformmain" name="transformmain" args="$(arg glogparam)" output="screen">
	  <param name="heightdiff_threshold" value="0.3"/>
	  </node>

  <node pkg="sensor_driver" type="masternode" name="masternode" args="$(arg glogparam)" output="screen">
  	<param name="config_file" value="$(arg configfile)"/>
  </node>

  <node pkg="sensor_driver" type="getmultivelodynedata" name="getmultivelodynedata" args="--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=2   $(arg logdir)" output="screen">
  </node>
 <node pkg="sensor_driver" type="getecudata" name="getecudata" args="--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=2   $(arg logdir)" output="screen">
  </node>
</group>

<group if="$(arg run_traversable_area_extraction)">
  <node name="traversibal_area_extraction_main" pkg="traversable_area_extraction"
      type="traversable_area_extraction_main" args="
          -traversable_area_extraction_configuration_directory $(find traversable_area_extraction)/cofiguration_file
          -traversable_area_extraction_configuration_basename traversable_area_extraction_config.lua
--logtostderr=0  --colorlogtostderr=1 --stderrthreshold=0   $(arg logdir)"          
      output="screen" >    
  </node>
<!--<node name="rviz" pkg="rviz" type="rviz" required="true"
     args="-d $(find traversable_area_extraction)/cofiguration_file/traversable_area_extraction.rviz" />-->

 <node pkg="ivrc_cross_communication" type="traversablearea_sub_test_main" name="traversablearea_sub_test_main"  output="screen"> 	
  </node>

<!--<node pkg="sub_test" type="sub_test_node" name="sub_test"  output="screen"> 	
  </node>
<node pkg="stiff" type="stiffdetect" name="stiff_detect"  output="screen"> 	
  </node>
<node pkg="slopeogm" type="slopenode" name="slopenode"  output="screen"> 	
  </node>
  <node pkg="negative_detection" type="negativenode" name="negativenode"  output="screen">
  <param name="heightdiff_threshold" value="0.3"/>
  <param name="N_SCANS" value="32"/>
  </node>
  <node pkg="depth_image_utils" type="depth_image_utils" name="depth_image_utils" output="screen">
  </node>
  
    <node pkg="flat_road" type="flat_roadnode" name="flat_roadnode"  output="screen">
  </node>-->
</group>
  

<group if="$(arg run_getindnode)">
  <node pkg="sensor_driver" type="getinsdata" name="getinsdata" args="$(arg glogparam)">
  </node>
</group>

<group if="$(arg gps_convert)">
 <node pkg="sensor_data_grabber" type="getgpsdata" name="getgpsdata">
  </node>   
  </group>

</launch>
